# CHANGELOG

## 2025-06-24
- Архитектурный рефакторинг: вынесены модели, сервисы, константы, утилиты в отдельные модули (TypeScript)
- Покрытие юнит-тестами: House, Phase, Scenario, CalculationService, StorageService, MigrationUtils
- Интеграция новой архитектуры в UI (index.html + main.ts)
- Перенос расчётов и вывода результатов на новую логику
- Оставлен старый app.js для плавного перехода
- Добавлен CHANGELOG.md для отслеживания изменений

## [1.2] - 2024-07-26

### Добавлено
- **Детализация OPEX:** Добавлены отдельные поля для ввода ФОТ, маркетинга, комиссии бронирования, расходных материалов и коммунальных услуг.
- **Налоговые режимы:** Добавлена возможность выбора системы налогообложения (УСН 6%, УСН 15%, ОСНО), влияющая на расчет чистого денежного потока.
- **Прозрачность расчетов OPEX:** В интерфейс добавлено поле "Итого OPEX (в год)", которое показывает общие годовые операционные расходы, масштабированные в зависимости от количества домов.
- **Подсказка для OPEX:** Добавлена иконка с подробной всплывающей подсказкой, объясняющей, как рассчитывается масштабирование "постоянных" операционных затрат.

### Исправлено
- **Масштабирование OPEX:** Исправлена фундаментальная ошибка в логике, при которой "постоянные" операционные расходы (ФОТ, маркетинг) не росли вместе с увеличением масштаба проекта. Теперь эти затраты корректно масштабируются от базового значения для 10 домов.
- **Подключение UI:** Исправлена ошибка, при которой изменения в новых полях OPEX и в стоимости жилого фонда не приводили к пересчету итоговых KPI.
- **Обновление подсказок:** Теперь при изменении количества домов или базовых ставок OPEX, текст во всплывающей подсказке обновляется автоматически.

## [1.1] - 2024-07-25

### Добавлено
- **Сезонность:** Внедрен помесячный расчет выручки с учетом коэффициентов сезонности для ADR (средней цены) и загрузки.
- **Инфляция/Рост:** Добавлены поля для настройки годового роста ADR и OPEX.
- **Разделение на вкладки:** Интерфейс переработан для разделения настроек CAPEX и Жилого фонда на разные вкладки для удобства.
- **Промежуточный итог:** Добавлен промежуточный итог по стоимости жилого фонда на соответствующей вкладке.
- **Дополнительные доходы:** Реализован расчет 9 видов дополнительных доходов с отображением выручки и прибыли по каждому.

### Исправлено
- **Логика CAPEX:** Восстановлена корректная логика распределения CAPEX по фазам строительства из оригинальной модели, что исправило неверную форму графика денежного потока.
- **Расчет операционных юнитов:** Исправлен подсчет количества действующих домов в каждый период времени.
- **Расчет окупаемости:** Формула расчета срока окупаемости заменена на более точную, корректно обрабатывающую дробные периоды.

## [1.0] - 2024-07-24

### Добавлено
- **Первоначальный рефакторинг:** Исходный код из `app.js` перенесен в модульную структуру TypeScript.
- **Модели данных:** Созданы классы `Scenario`, `Phase`, `House` для представления структуры данных.
- **Сервисы:** Логика расчетов вынесена в `CalculationService`, работа с хранилищем (пока не используется) в `storageService`.
- **Константы:** Типы домов и другие постоянные величины вынесены в отдельные файлы.
- **Автоматическое тестирование:** Написаны 27 модульных тестов для проверки корректности работы моделей и сервисов.
- **Сборка проекта:** Настроен Vite для сборки TypeScript проекта и его подключения к `index.html`.

### Исправлено
- **Интеграция с UI:** Устранены первоначальные ошибки с подключением `main.ts` к `index.html` и привязкой обработчиков событий.
- **Обновлены типы домов:** Список типов домов в модели синхронизирован с актуальным документом ("комфорт", "премиум база").

## [1.0.0] - 2024-07-24

### Added
- **Project Scaffolding**: Initialized the project with Vite, TypeScript, and Jest.
- **Core Architecture**: Created a modular structure with models (`House`, `Phase`, `Scenario`), services (`CalculationService`), and constants.
- **Unit Tests**: Implemented comprehensive unit tests for all backend logic, achieving 100% test coverage.
- **Initial UI Integration**: Created `main.ts` as the new entry point and wired it to the existing `index.html`.
- **Documentation**: Created `financial_model_enhancement_roadmap.md`, `phase1_plan.md`, `implementation_summary.md`, and this `CHANGELOG.md`. 